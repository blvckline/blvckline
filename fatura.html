<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>BLVCKLINE Fatura</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #25d366;
      margin-bottom: 10px;
    }
    .invoice {
      background: #111;
      padding: 20px;
      border-radius: 12px;
      max-width: 400px;
      margin: 0 auto;
    }
    .preview {
      width: 100%;
      max-height: 300px;
      object-fit: contain;
      border: 2px solid #25d366;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .details {
      text-align: left;
      margin-bottom: 20px;
    }
    .details dt {
      font-weight: bold;
      margin-top: 10px;
    }
    .details dd {
      margin: 0 0 10px;
    }
    .toggle {
      margin: 15px 0;
      text-align: left;
    }
    .btn {
      display: inline-block;
      padding: 12px 24px;
      background: #25d366;
      color: #000;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      cursor: pointer;
      margin: 5px;
    }
  </style>
</head>
<body>
  <h1>Faturanız Hazır</h1>
  <div class="invoice">
    <img id="preview" class="preview" src="" alt="Tasarım Önizleme">
    <dl class="details">
      <dt>Ürün:</dt><dd id="info-type">—</dd>
      <dt>Renk:</dt><dd id="info-color">—</dd>
      <dt>Tarih:</dt><dd id="info-date">—</dd>
      <dt>Birim Fiyat:</dt><dd id="info-unit-price">—</dd>
      <dt>Kargo:</dt><dd id="info-shipping">—</dd>
      <dt>Logo Kaldırma Ücreti:</dt><dd id="info-logo">—</dd>
      <dt>Toplam:</dt><dd id="info-total">—</dd>
    </dl>
    <div class="toggle">
      <label>
        <input type="checkbox" id="logoToggle">
        Logoyu Kaldırmak İstiyorum (+60 ₺)
      </label>
    </div>
    <a id="payBtn" href="#" class="btn" target="_blank">Ödemeye Geç</a>
    <a id="waBtn" href="#" class="btn" target="_blank">Sipariş Gönder</a>
  </div>

  <script>
    // URL parametrelerini al
    const params   = new URLSearchParams(location.search);
    const tasarim  = params.get('tasarim');
    const gorsel   = params.get('gorsel');
    const type     = params.get('tip')  || '—';
    const color    = params.get('renk') || '—';

    // Map tanımlamaları
    const nameMap  = {tisort:'Tişört', crop:'Crop Top', sweat:'Sweatshirt'};
    const colorMap = {siyah:'Siyah', beyaz:'Beyaz', gri:'Gri'};
    const priceMap = {tisort:199, crop:179, sweat:219};
    const shipping = 60;
    const logoFee  = 60;

    // Önizleme resmi: önce base64 (tasarım), sonra dosya adı (galeri)
    const previewEl = document.getElementById('preview');
    if (tasarim) {
      // html2canvas'tan gelen data URI
      previewEl.src = tasarim;
    } else if (gorsel) {
      // baskı galerisinden gelen dosya adı
      previewEl.src = gorsel;
    } else {
      previewEl.alt = 'Önizleme bulunamadı';
    }

    // Bilgileri ekle
    document.getElementById('info-type').textContent       = nameMap[type]  || type;
    document.getElementById('info-color').textContent      = colorMap[color]|| color;
    document.getElementById('info-date').textContent       = new Date().toLocaleString('tr-TR');
    document.getElementById('info-unit-price').textContent = priceMap[type]
      .toLocaleString('tr-TR', {style:'currency',currency:'TRY'});
    document.getElementById('info-shipping').textContent    = shipping
      .toLocaleString('tr-TR', {style:'currency',currency:'TRY'});

    // Toplam hesaplama ve buton linkleri
    const logoToggle = document.getElementById('logoToggle');
    function updateTotal() {
      const base  = priceMap[type]    || 0;
      const logo  = logoToggle.checked ? logoFee : 0;
      const total = base + shipping + logo;

      document.getElementById('info-logo').textContent  = logo
        .toLocaleString('tr-TR', {style:'currency',currency:'TRY'});
      document.getElementById('info-total').textContent = total
        .toLocaleString('tr-TR', {style:'currency',currency:'TRY'});

      // Shopier ödemesi
      document.getElementById('payBtn').href = 
        `https://www.shopier.com/blvckline?amount=${total}`;

      // WhatsApp sipariş
      const waText = encodeURIComponent(
        `Merhaba BLVCKLINE, ${nameMap[type]} (${colorMap[color]}) ürünü ` +
        `sipariş vermek istiyorum. Toplam tutar: ${total} ₺.`
      );
      document.getElementById('waBtn').href =
        `https://wa.me/905399132540?text=${waText}`;
    }

    logoToggle.addEventListener('change', updateTotal);
    updateTotal();
  </script>
</body>
</html>
